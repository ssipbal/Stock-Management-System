<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NFC Smart Inventory Management System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .hidden { display: none; }
    .toggle-buttons {
      margin-bottom: 20px;
    }
    button {
      padding: 8px 16px;
      margin-right: 8px;
      cursor: pointer;
    }
    #stock-list {
      list-style: none;
      padding-left: 0;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

  <div class="toggle-buttons">
    <button id="btnAdmin">Admin Mode</button>
    <button id="btnCustomer">Customer Mode</button>
  </div>

  <!-- Stock Display (common to both) -->
  <div>
    <h3>Current Stock</h3>
    <ul id="stock-list"><li>Loading...</li></ul>
  </div>

  <!-- Admin form (full control) -->
  <form id="adminForm">
    <h3>Admin Controls</h3>
    <label>
      Item:
      <select id="adminItem">
        <option value="Cookie">Cookie</option>
        <option value="Brownie">Brownie</option>
        <option value="Macaron">Macaron</option>
      </select>
    </label>
    <label>
      Quantity:
      <input type="number" id="adminQuantity" min="1" value="1" />
    </label>
    <label>
      Action:
      <select id="adminAction">
        <option value="Add">Add</option>
        <option value="Remove">Remove</option>
      </select>
    </label>
    <button type="submit">Submit</button>
  </form>

  <!-- Customer form (simplified + summary) -->
  <div id="customerSection" class="hidden">
    <h3>Customer Purchase</h3>
    <label>
      Item:
      <select id="customerItem">
        <option value="Cookie">Cookie</option>
        <option value="Brownie">Brownie</option>
        <option value="Macaron">Macaron</option>
      </select>
    </label>
    <label>
      Quantity:
      <input type="number" id="customerQuantity" min="1" value="1" />
    </label>
    <button id="addToSummaryBtn">Add to Summary</button>

    <h4>Purchase Summary</h4>
    <ul id="purchaseSummaryList"></ul>

    <button id="confirmPurchaseBtn" disabled>Confirm Purchase</button>
  </div>

  <p id="response"></p>

  <script>
    const stockURL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE';

    const stockList = document.getElementById('stock-list');
    const responseP = document.getElementById('response');

    const adminForm = document.getElementById('adminForm');
    const customerSection = document.getElementById('customerSection');
    const purchaseSummaryList = document.getElementById('purchaseSummaryList');
    const confirmPurchaseBtn = document.getElementById('confirmPurchaseBtn');

    let currentStock = {};
    let purchaseCart = {};

    // Toggle buttons
    document.getElementById('btnAdmin').addEventListener('click', () => {
      adminForm.classList.remove('hidden');
      customerSection.classList.add('hidden');
      responseP.innerText = '';
    });

    document.getElementById('btnCustomer').addEventListener('click', () => {
      adminForm.classList.add('hidden');
      customerSection.classList.remove('hidden');
      responseP.innerText = '';
      purchaseCart = {};
      renderSummary();
    });

    // Load and show stock
    function updateLiveStock() {
      fetch(stockURL)
        .then(res => res.json())
        .then(data => {
          currentStock = data.stock || data; // depending on API response
          stockList.innerHTML = '';
          for (const item in currentStock) {
            const li = document.createElement('li');
            li.textContent = `${item}: ${currentStock[item]}`;
            stockList.appendChild(li);
          }
        })
        .catch(() => {
          stockList.innerHTML = '<li>Failed to load stock.</li>';
        });
    }
    updateLiveStock();

    // Admin form submit
    adminForm.addEventListener('submit', e => {
      e.preventDefault();
      const item = document.getElementById('adminItem').value;
      const quantity = document.getElementById('adminQuantity').value;
      const action = document.getElementById('adminAction').value;

      const url = `${stockURL}?item=${encodeURIComponent(item)}&action=${encodeURIComponent(action)}&quantity=${encodeURIComponent(quantity)}`;
      fetch(url)
        .then(res => res.json())
        .then(data => {
          responseP.innerText = '✅ Admin update successful';
          updateLiveStock();
        })
        .catch(err => {
          responseP.innerText = '❌ Admin update failed: ' + err;
        });
    });

    // Customer add to summary
    document.getElementById('addToSummaryBtn').addEventListener('click', e => {
      e.preventDefault();
      const item = document.getElementById('customerItem').value;
      const quantity = parseInt(document.getElementById('customerQuantity').value, 10);
      if (!quantity || quantity <= 0) return alert('Quantity must be positive');

      // Add or update item in purchaseCart
      if (purchaseCart[item]) purchaseCart[item] += quantity;
      else purchaseCart[item] = quantity;

      renderSummary();
    });

    // Render purchase summary list
    function renderSummary() {
      purchaseSummaryList.innerHTML = '';
      const keys = Object.keys(purchaseCart);
      if (keys.length === 0) {
        purchaseSummaryList.innerHTML = '<li>No items added</li>';
        confirmPurchaseBtn.disabled = true;
        return;
      }
      keys.forEach(item => {
        const li = document.createElement('li');
        li.textContent = `${item}: ${purchaseCart[item]}`;
        purchaseSummaryList.appendChild(li);
      });
      confirmPurchaseBtn.disabled = false;
    }

    // Confirm purchase button
    confirmPurchaseBtn.addEventListener('click', () => {
      // Deduct each item quantity from stock
      const promises = Object.entries(purchaseCart).map(([item, qty]) => {
        const url = `${stockURL}?item=${encodeURIComponent(item)}&action=Remove&quantity=${encodeURIComponent(qty)}`;
        return fetch(url).then(res => res.json());
      });

      Promise.all(promises)
        .then(results => {
          responseP.innerText = '✅ Purchase confirmed!';
          purchaseCart = {};
          renderSummary();
          updateLiveStock();
        })
        .catch(err => {
          responseP.innerText = '❌ Purchase confirmation failed: ' + err;
        });
    });

    // Start in admin mode by default
    document.getElementById('btnAdmin').click();

  </script>

</body>
</html>
